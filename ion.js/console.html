<!doctype html>
<html lang="">

  <head>
    <meta charset="utf-8">
    <title>ION Tools Console Testing Page</title>

    <style>

      [wrap-text] {
        white-space: pre-line;
        word-break: break-all;
      }

    </style>
  </head>

  <body>

    <button id="generate_did">Generate Test DID</button>
    <button id="submit_pow" style="display: none;">Test submit DID</button>

    <h3>Short-Form DID URI</h3>
    <pre id="print_short"></pre>

    <h3>Long-Form DID URI</h3>
    <pre id="print_long" wrap-text></pre>

    <h3>Create DID Request Object</h3>
    <pre id="print_request"></pre>

    <script src="../dist/ion.js"></script>
    <script>

      async function generateDID(){
        let authnKeys = await ION.generateKeyPair();
        return new ION.DID({
          content: {
            publicKeys: [
              {
                id: 'key-1',
                type: 'EcdsaSecp256k1VerificationKey2019',
                publicKeyJwk: authnKeys.publicJwk,
                purposes: [ 'authentication' ]
              }
            ],
            services: [
              {
                id: 'domain-1',
                type: 'LinkedDomains',
                serviceEndpoint: 'https://foo.example.com'
              }
            ]
          }
        });
      };

      JSON.pretty = json => JSON.stringify(json, null, 2)
      let request;

      generate_did.addEventListener('click', async e => {
        let did = await generateDID();
        print_short.textContent = JSON.pretty(await did.getURI('short'))
        print_long.textContent = JSON.pretty(await did.getURI('long'))

        request = await did.generateRequest(0)
        print_request.textContent = JSON.pretty(request)
      });

      submit_pow.addEventListener('click', async () => {
        submit_pow.textContent = "submitting request... look at console to see progress and result"
        await (new ION.POW).submitIonRequest(request)
      })
    </script>
  </body>

</html>
